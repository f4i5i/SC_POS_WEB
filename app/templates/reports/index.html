{% extends "base.html" %}

{% block title %}Reports & Analytics - {{ business_name }}{% endblock %}

{% block extra_css %}
<style>
    .report-card {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 1.5rem;
        transition: all 0.3s;
        border-left: 4px solid;
    }

    .report-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    .report-card-1 { border-left-color: #3B82F6; }
    .report-card-2 { border-left-color: #10B981; }
    .report-card-3 { border-left-color: #F59E0B; }
    .report-card-4 { border-left-color: #EF4444; }
    .report-card-5 { border-left-color: #8B5CF6; }

    .report-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        margin-bottom: 1rem;
    }

    .report-title {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .report-description {
        color: #6B7280;
        margin-bottom: 1.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="mb-4">
    <h2><i class="fas fa-chart-bar"></i> Reports & Analytics</h2>
    <p class="text-muted">Access comprehensive business reports and analytics</p>
</div>

<div class="row">
    <!-- Daily Report - Visible to all with report.view_sales -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="report-card report-card-1">
            <div class="report-icon" style="background: #EFF6FF; color: #3B82F6;">
                <i class="fas fa-calendar-day"></i>
            </div>
            <div class="report-title">Daily Report</div>
            <p class="report-description">View today's sales, transactions, and performance metrics</p>
            <a href="{{ url_for('reports.daily_report') }}" class="btn btn-primary w-100">
                <i class="fas fa-arrow-right"></i> View Report
            </a>
        </div>
    </div>

    {% if current_user.role not in ['store_manager'] %}
    <!-- Weekly Report - Visible to manager and above -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="report-card report-card-2">
            <div class="report-icon" style="background: #D1FAE5; color: #10B981;">
                <i class="fas fa-calendar-week"></i>
            </div>
            <div class="report-title">Weekly Report</div>
            <p class="report-description">Compare weekly sales performance and trends</p>
            <a href="{{ url_for('reports.weekly_report') }}" class="btn btn-success w-100">
                <i class="fas fa-arrow-right"></i> View Report
            </a>
        </div>
    </div>

    <!-- Monthly Report -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="report-card report-card-3">
            <div class="report-icon" style="background: #FEF3C7; color: #F59E0B;">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="report-title">Monthly Report</div>
            <p class="report-description">Comprehensive monthly sales analysis and insights</p>
            <a href="{{ url_for('reports.monthly_report') }}" class="btn btn-warning w-100">
                <i class="fas fa-arrow-right"></i> View Report
            </a>
        </div>
    </div>
    {% endif %}

    {% if current_user.role not in ['store_manager', 'manager'] %}
    <!-- Custom Report - Hidden from store_manager and manager -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="report-card report-card-4">
            <div class="report-icon" style="background: #FEE2E2; color: #EF4444;">
                <i class="fas fa-filter"></i>
            </div>
            <div class="report-title">Custom Report</div>
            <p class="report-description">Generate reports for custom date ranges</p>
            <a href="{{ url_for('reports.custom_report') }}" class="btn btn-danger w-100">
                <i class="fas fa-arrow-right"></i> View Report
            </a>
        </div>
    </div>

    <!-- Inventory Valuation -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="report-card report-card-5">
            <div class="report-icon" style="background: #EDE9FE; color: #8B5CF6;">
                <i class="fas fa-boxes"></i>
            </div>
            <div class="report-title">Inventory Valuation</div>
            <p class="report-description">Stock value, cost analysis, and profit potential</p>
            <a href="{{ url_for('reports.inventory_valuation') }}" class="btn btn-outline-primary w-100">
                <i class="fas fa-arrow-right"></i> View Report
            </a>
        </div>
    </div>

    <!-- Stock Valuation by Location -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="report-card" style="border-left-color: #059669;">
            <div class="report-icon" style="background: #D1FAE5; color: #059669;">
                <i class="fas fa-warehouse"></i>
            </div>
            <div class="report-title">Stock Valuation by Location</div>
            <p class="report-description">Cost & selling worth of stock per store with production summary</p>
            <a href="{{ url_for('reports.stock_valuation') }}" class="btn btn-outline-success w-100">
                <i class="fas fa-arrow-right"></i> View Report
            </a>
        </div>
    </div>

    <!-- Stock Reconciliation Report -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="report-card" style="border-left-color: #7C3AED;">
            <div class="report-icon" style="background: #EDE9FE; color: #7C3AED;">
                <i class="fas fa-balance-scale"></i>
            </div>
            <div class="report-title">Stock Reconciliation</div>
            <p class="report-description">Validate stock with purchases, sales & adjustments</p>
            <a href="{{ url_for('reports.stock_reconciliation') }}" class="btn btn-outline-primary w-100">
                <i class="fas fa-arrow-right"></i> View Report
            </a>
        </div>
    </div>

    <!-- Raw Material Stock Report -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="report-card" style="border-left-color: #D97706;">
            <div class="report-icon" style="background: #FEF3C7; color: #D97706;">
                <i class="fas fa-flask"></i>
            </div>
            <div class="report-title">Raw Material Stock</div>
            <p class="report-description">Track oils, ethanol, bottles & production materials</p>
            <a href="{{ url_for('reports.raw_material_stock') }}" class="btn btn-outline-warning w-100">
                <i class="fas fa-arrow-right"></i> View Report
            </a>
        </div>
    </div>

    <!-- Purchase Register -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="report-card" style="border-left-color: #0891B2;">
            <div class="report-icon" style="background: #CFFAFE; color: #0891B2;">
                <i class="fas fa-file-invoice-dollar"></i>
            </div>
            <div class="report-title">Purchase Register</div>
            <p class="report-description">All purchases with payment status and dues</p>
            <a href="{{ url_for('reports.purchase_register') }}" class="btn btn-outline-info w-100">
                <i class="fas fa-arrow-right"></i> View Report
            </a>
        </div>
    </div>

    <!-- Stock Movement Audit Trail -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="report-card" style="border-left-color: #475569;">
            <div class="report-icon" style="background: #F1F5F9; color: #475569;">
                <i class="fas fa-history"></i>
            </div>
            <div class="report-title">Stock Movement Audit</div>
            <p class="report-description">Complete history of all stock changes</p>
            <a href="{{ url_for('reports.stock_movement_audit') }}" class="btn btn-outline-secondary w-100">
                <i class="fas fa-arrow-right"></i> View Report
            </a>
        </div>
    </div>

    <!-- Transfer Discrepancy Report -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="report-card" style="border-left-color: #DC2626;">
            <div class="report-icon" style="background: #FEE2E2; color: #DC2626;">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="report-title">Transfer Discrepancy</div>
            <p class="report-description">Variances between dispatched and received stock</p>
            <a href="{{ url_for('reports.transfer_discrepancy') }}" class="btn btn-outline-danger w-100">
                <i class="fas fa-arrow-right"></i> View Report
            </a>
        </div>
    </div>

    <!-- Employee Performance Report -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="report-card" style="border-left-color: #06B6D4;">
            <div class="report-icon" style="background: #CFFAFE; color: #06B6D4;">
                <i class="fas fa-users-cog"></i>
            </div>
            <div class="report-title">Employee Performance</div>
            <p class="report-description">Track employee sales and productivity metrics</p>
            <a href="{{ url_for('reports.employee_performance') }}" class="btn btn-outline-info w-100">
                <i class="fas fa-arrow-right"></i> View Report
            </a>
        </div>
    </div>

    <!-- Product Performance Report -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="report-card" style="border-left-color: #EC4899;">
            <div class="report-icon" style="background: #FCE7F3; color: #EC4899;">
                <i class="fas fa-box-open"></i>
            </div>
            <div class="report-title">Product Performance</div>
            <p class="report-description">Analyze top & worst selling products</p>
            <a href="{{ url_for('reports.product_performance') }}" class="btn btn-outline-pink w-100">
                <i class="fas fa-arrow-right"></i> View Report
            </a>
        </div>
    </div>

    <!-- Sales by Category Report -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="report-card" style="border-left-color: #14B8A6;">
            <div class="report-icon" style="background: #CCFBF1; color: #14B8A6;">
                <i class="fas fa-layer-group"></i>
            </div>
            <div class="report-title">Sales by Category</div>
            <p class="report-description">Category-wise sales breakdown and analysis</p>
            <a href="{{ url_for('reports.sales_by_category') }}" class="btn btn-outline-success w-100">
                <i class="fas fa-arrow-right"></i> View Report
            </a>
        </div>
    </div>

    <!-- Profit & Loss Report -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="report-card" style="border-left-color: #F97316;">
            <div class="report-icon" style="background: #FFEDD5; color: #F97316;">
                <i class="fas fa-file-invoice-dollar"></i>
            </div>
            <div class="report-title">Profit & Loss</div>
            <p class="report-description">Complete P&L statement with COGS and margins</p>
            <a href="{{ url_for('reports.profit_loss') }}" class="btn btn-outline-warning w-100">
                <i class="fas fa-arrow-right"></i> View Report
            </a>
        </div>
    </div>

    <!-- Customer Analysis Report -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="report-card" style="border-left-color: #A855F7;">
            <div class="report-icon" style="background: #F3E8FF; color: #A855F7;">
                <i class="fas fa-users"></i>
            </div>
            <div class="report-title">Customer Analysis</div>
            <p class="report-description">Customer behavior and loyalty tier insights</p>
            <a href="{{ url_for('reports.customer_analysis') }}" class="btn btn-outline-primary w-100">
                <i class="fas fa-arrow-right"></i> View Report
            </a>
        </div>
    </div>

    <!-- Export Options -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="report-card" style="border-left-color: #6B7280;">
            <div class="report-icon" style="background: #F3F4F6; color: #6B7280;">
                <i class="fas fa-file-export"></i>
            </div>
            <div class="report-title">Export Reports</div>
            <p class="report-description">Download reports in PDF or Excel format</p>
            <button class="btn btn-outline-secondary w-100" onclick="showExportOptions()">
                <i class="fas fa-download"></i> Export Options
            </button>
        </div>
    </div>
    {% endif %}
</div>

{% if current_user.role != 'store_manager' %}
<!-- Quick Stats -->
<div class="card mt-4">
    <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-tachometer-alt"></i> Quick Overview</h5>
    </div>
    <div class="card-body">
        <div class="row text-center">
            <div class="col-md-3">
                <h3 class="text-primary">-</h3>
                <p class="text-muted">Today's Sales</p>
            </div>
            <div class="col-md-3">
                <h3 class="text-success">-</h3>
                <p class="text-muted">This Week</p>
            </div>
            <div class="col-md-3">
                <h3 class="text-warning">-</h3>
                <p class="text-muted">This Month</p>
            </div>
            <div class="col-md-3">
                <h3 class="text-info">-</h3>
                <p class="text-muted">Total Revenue</p>
            </div>
        </div>
        <div class="text-center mt-3">
            <small class="text-muted">Visit individual reports for detailed analytics</small>
        </div>
    </div>
</div>
{% endif %}

<!-- Export Modal -->
<div class="modal fade" id="exportModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-file-export"></i> Export Report</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Report Type</label>
                    <select class="form-select" id="export_type">
                        <option value="daily">Daily Report</option>
                        <option value="weekly">Weekly Report</option>
                        <option value="monthly">Monthly Report</option>
                        <option value="custom">Custom Report</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Format</label>
                    <select class="form-select" id="export_format">
                        <option value="pdf">PDF</option>
                        <option value="excel">Excel</option>
                        <option value="csv">CSV</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Date</label>
                    <input type="date" class="form-control" id="export_date" value="{{ datetime.now().strftime('%Y-%m-%d') if datetime else '' }}">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="exportReport()">
                    <i class="fas fa-download"></i> Export
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function showExportOptions() {
    new bootstrap.Modal(document.getElementById('exportModal')).show();
}

function exportReport() {
    const type = $('#export_type').val();
    const format = $('#export_format').val();
    const date = $('#export_date').val();

    let url = `/reports/export-${type}-${format}`;
    if (date) {
        url += `?date=${date}`;
    }

    window.open(url, '_blank');
    bootstrap.Modal.getInstance(document.getElementById('exportModal')).hide();
}
</script>
{% endblock %}
