{% extends "base.html" %}

{% block title %}{{ supplier.name }} - {{ business_name }}{% endblock %}

{% block extra_css %}
<style>
    .supplier-header {
        background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        color: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
    }

    .info-card {
        border-left: 4px solid #10B981;
        background: #F9FAFB;
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 1rem;
    }

    .product-card {
        transition: all 0.3s;
        border-radius: 12px;
    }

    .product-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 16px rgba(0,0,0,0.1);
    }

    .product-image {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 8px;
    }

    .stat-card {
        background: linear-gradient(135deg, #D1FAE5 0%, #A7F3D0 100%);
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
    }

    .stat-number {
        font-size: 2rem;
        font-weight: bold;
        color: #065F46;
    }

    /* Clean Theme Overrides for Supplier */
    [data-theme="clean"] .supplier-header {
        background: #059669 !important;
    }

    [data-theme="clean"] .stat-card {
        background: #DCFCE7 !important;
        border: 1px solid #BBF7D0 !important;
    }

    [data-theme="clean"] .stat-number {
        color: #065F46 !important;
    }

    [data-theme="clean"] .info-card {
        background: #F8FAFC !important;
        border-left: 4px solid #059669 !important;
    }

    [data-theme="clean"] .product-card {
        background: #FFFFFF !important;
        border: 1px solid #E2E8F0 !important;
    }

    [data-theme="clean"] .product-card:hover {
        transform: none !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
    }

    /* Fix outline buttons for better contrast */
    [data-theme="clean"] .btn-outline-secondary {
        border: 2px solid #475569 !important;
        color: #1E293B !important;
        background: #FFFFFF !important;
    }

    [data-theme="clean"] .btn-outline-secondary:hover {
        background: #475569 !important;
        color: #FFFFFF !important;
    }

    [data-theme="clean"] .btn-outline-primary {
        border: 2px solid #2563EB !important;
        color: #2563EB !important;
        background: #FFFFFF !important;
    }

    [data-theme="clean"] .btn-outline-primary:hover {
        background: #2563EB !important;
        color: #FFFFFF !important;
    }

    [data-theme="clean"] .btn-outline-success {
        border: 2px solid #059669 !important;
        color: #059669 !important;
        background: #FFFFFF !important;
    }

    [data-theme="clean"] .btn-outline-success:hover {
        background: #059669 !important;
        color: #FFFFFF !important;
    }

    [data-theme="clean"] .btn-outline-danger {
        border: 2px solid #DC2626 !important;
        color: #DC2626 !important;
        background: #FFFFFF !important;
    }

    [data-theme="clean"] .btn-outline-danger:hover {
        background: #DC2626 !important;
        color: #FFFFFF !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1">
                <i class="fas fa-building text-success"></i>
                Supplier Details
            </h2>
            <p class="text-muted mb-0">View supplier information and products</p>
        </div>
        <div>
            <a href="{{ url_for('suppliers.index') }}" class="btn btn-outline-secondary me-2">
                <i class="fas fa-arrow-left"></i> Back to Suppliers
            </a>
            <a href="{{ url_for('suppliers.edit_supplier', supplier_id=supplier.id) }}" class="btn btn-success">
                <i class="fas fa-edit"></i> Edit Supplier
            </a>
        </div>
    </div>

    <div class="row g-4">
        <!-- Supplier Information -->
        <div class="col-md-4">
            <div class="supplier-header">
                <h3 class="mb-3">{{ supplier.name }}</h3>
                <div class="mb-2">
                    <i class="fas fa-user me-2"></i>
                    <strong>Contact:</strong> {{ supplier.contact_person }}
                </div>
                <div class="mb-2">
                    <i class="fas fa-phone me-2"></i>
                    <strong>Phone:</strong> {{ supplier.phone }}
                </div>
                {% if supplier.email %}
                <div class="mb-2">
                    <i class="fas fa-envelope me-2"></i>
                    <strong>Email:</strong> {{ supplier.email }}
                </div>
                {% endif %}
                {% if supplier.address %}
                <div class="mb-2">
                    <i class="fas fa-map-marker-alt me-2"></i>
                    <strong>Address:</strong> {{ supplier.address }}
                </div>
                {% endif %}
            </div>

            <!-- Statistics -->
            <div class="row g-3 mb-4">
                <div class="col-12">
                    <div class="stat-card">
                        <div class="stat-number">{{ product_count }}</div>
                        <div class="text-muted">Products</div>
                    </div>
                </div>
                <div class="col-12">
                    <div class="stat-card">
                        <div class="stat-number">
                            Rs. {{ "{:,.0f}".format(total_cost_value) }}
                        </div>
                        <div class="text-muted">Total Cost Value</div>
                    </div>
                </div>
            </div>

            <!-- Payment Terms -->
            {% if supplier.payment_terms %}
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body">
                    <h6 class="mb-3">
                        <i class="fas fa-money-check-alt text-success"></i>
                        Payment Terms
                    </h6>
                    <p class="text-muted mb-0">{{ supplier.payment_terms }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Notes -->
            {% if supplier.notes %}
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h6 class="mb-3">
                        <i class="fas fa-sticky-note text-warning"></i>
                        Notes
                    </h6>
                    <p class="text-muted mb-0">{{ supplier.notes }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Additional Info -->
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-body">
                    <h6 class="mb-3">
                        <i class="fas fa-info-circle text-info"></i>
                        Additional Information
                    </h6>
                    <div class="mb-2">
                        <small class="text-muted">Added On:</small>
                        <div>{{ supplier.created_at.strftime('%B %d, %Y') if supplier.created_at else 'N/A' }}</div>
                    </div>
                    <div class="mb-2">
                        <small class="text-muted">Status:</small>
                        <div>
                            {% if supplier.is_active %}
                            <span class="badge bg-success">Active</span>
                            {% else %}
                            <span class="badge bg-danger">Inactive</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products from this Supplier -->
        <div class="col-md-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-boxes text-success"></i>
                            Products from {{ supplier.name }}
                        </h5>
                        <a href="{{ url_for('inventory.add_product') }}?supplier_id={{ supplier.id }}" class="btn btn-sm btn-success">
                            <i class="fas fa-plus"></i> Add Product
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    {% if products.items %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Product</th>
                                    <th>Category</th>
                                    <th class="text-center">Stock</th>
                                    <th class="text-end">Cost Price</th>
                                    <th class="text-end">Selling Price</th>
                                    <th class="text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for product in products.items %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            {% if product.image_url %}
                                            <img src="{{ product.image_url }}" alt="{{ product.name }}"
                                                 class="rounded me-2"
                                                 style="width: 40px; height: 40px; object-fit: cover;">
                                            {% else %}
                                            <div class="bg-light rounded me-2 d-flex align-items-center justify-content-center"
                                                 style="width: 40px; height: 40px;">
                                                <i class="fas fa-box text-muted"></i>
                                            </div>
                                            {% endif %}
                                            <div>
                                                <div class="fw-bold">{{ product.name }}</div>
                                                <small class="text-muted"><code>{{ product.code }}</code></small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        {% if product.category %}
                                        <span class="badge bg-info">{{ product.category.name }}</span>
                                        {% else %}
                                        <span class="text-muted">-</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        {% if product.quantity == 0 %}
                                        <span class="badge bg-danger">Out of Stock</span>
                                        {% elif product.is_low_stock %}
                                        <span class="badge bg-warning">{{ product.quantity }}</span>
                                        {% else %}
                                        <span class="badge bg-success">{{ product.quantity }}</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-end">Rs. {{ "{:,.2f}".format(product.cost_price) }}</td>
                                    <td class="text-end fw-bold">Rs. {{ "{:,.2f}".format(product.selling_price) }}</td>
                                    <td class="text-center">
                                        <div class="btn-group btn-group-sm">
                                            <a href="{{ url_for('inventory.edit_product', product_id=product.id) }}"
                                               class="btn btn-outline-primary" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <a href="{{ url_for('inventory.stock_movements', product_id=product.id) }}"
                                               class="btn btn-outline-secondary" title="Stock History">
                                                <i class="fas fa-history"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <!-- Products Pagination -->
                    {% if products.pages > 1 %}
                    <nav class="mt-3">
                        <ul class="pagination pagination-sm justify-content-center mb-0">
                            <li class="page-item {% if not products.has_prev %}disabled{% endif %}">
                                <a class="page-link" href="{{ url_for('suppliers.view_supplier', supplier_id=supplier.id, page=products.prev_num) }}">
                                    <i class="fas fa-chevron-left"></i>
                                </a>
                            </li>
                            {% for page_num in products.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                                {% if page_num %}
                                <li class="page-item {% if page_num == products.page %}active{% endif %}">
                                    <a class="page-link" href="{{ url_for('suppliers.view_supplier', supplier_id=supplier.id, page=page_num) }}">
                                        {{ page_num }}
                                    </a>
                                </li>
                                {% else %}
                                <li class="page-item disabled">
                                    <span class="page-link">...</span>
                                </li>
                                {% endif %}
                            {% endfor %}
                            <li class="page-item {% if not products.has_next %}disabled{% endif %}">
                                <a class="page-link" href="{{ url_for('suppliers.view_supplier', supplier_id=supplier.id, page=products.next_num) }}">
                                    <i class="fas fa-chevron-right"></i>
                                </a>
                            </li>
                        </ul>
                    </nav>
                    <div class="text-center mt-2">
                        <small class="text-muted">
                            Showing {{ ((products.page - 1) * products.per_page) + 1 }} -
                            {{ min(products.page * products.per_page, products.total) }} of {{ products.total }} products
                        </small>
                    </div>
                    {% endif %}
                    {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-box-open fa-4x text-muted mb-3"></i>
                        <h5 class="text-muted">No Products Yet</h5>
                        <p class="text-muted">No products from this supplier in the inventory.</p>
                        <a href="{{ url_for('inventory.add_product') }}?supplier_id={{ supplier.id }}"
                           class="btn btn-success">
                            <i class="fas fa-plus"></i> Add First Product
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-body">
                    <h6 class="mb-3">
                        <i class="fas fa-bolt text-warning"></i>
                        Quick Actions
                    </h6>
                    <div class="d-flex flex-wrap gap-2">
                        <a href="{{ url_for('suppliers.edit_supplier', supplier_id=supplier.id) }}"
                           class="btn btn-outline-primary">
                            <i class="fas fa-edit"></i> Edit Information
                        </a>
                        <a href="{{ url_for('inventory.add_product') }}?supplier_id={{ supplier.id }}"
                           class="btn btn-outline-success">
                            <i class="fas fa-plus"></i> Add Product
                        </a>
                        <button class="btn btn-outline-danger" onclick="deleteSupplier()">
                            <i class="fas fa-trash"></i> Delete Supplier
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function deleteSupplier() {
    if (!confirm('Are you sure you want to delete this supplier?\n\nThis will not delete the products from this supplier.')) {
        return;
    }

    $.ajax({
        url: `/suppliers/delete/{{ supplier.id }}`,
        method: 'POST',
        success: function(response) {
            window.location.href = "{{ url_for('suppliers.index') }}";
        },
        error: function(xhr) {
            alert('Error: ' + (xhr.responseJSON?.error || 'Failed to delete supplier'));
        }
    });
}
</script>
{% endblock %}
